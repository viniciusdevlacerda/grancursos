/**
 * Classe PreMatricula
 *
 * @author Alexandre Chinaider <chinaider_ale@live.com>
 * @copyright Copyright (c) 2006-2016 Unyleya Brasil Inc. (http://unyleya.com.br/)
 */
function PreMatricula(modal) {
    var e = $("select[name='estado']"), t = $("select[name='cidade']"), n = $("select[name='areas']"),
        a = $("select[name='codcurso']"), p = $("select[name='polo']"), imp = $("select[name='areas_concurso']");
    this.construct = function () {
        o(), i(), areas_imp(), outrasLocalidades()
    };
    var areas_imp = function () {
        imp.change(function () {
            var area = $(this).val();
            t = $("#" + this.form.id + " select[name='codcurso']"), $.ajax({
                url: "/request/get/produtosarea/" + area,
                type: "get",
                beforeSend: function () {
                    t.attr("disabled", "disabled"), t.find("option").remove(), t.append($("<option/>").val("").text("Aguarde..."))
                },
                complete: function (e) {
                    var n = JSON.parse(atob(e.responseText));
                    // t.find("option").remove(),
                        t.append($("<option/>").val("").text("SELECIONE UM PRODUTO")),
                        t.find("option").eq(0).remove(), $.each(n, function (e, n) {
                        t.append($("<option/>").val(e).text(n))
                    }), t.removeAttr("disabled");
                    if (modal !== undefined) {
                        t.material_select('destroy');
                        t.material_select();
                    }
                }
            })
        })
    }

    var o = function () {
        e.change(function () {
            var e = $(this).val();
            t = $("#" + this.form.id + " select[name='cidade']"), $.ajax({
                url: "/request/get/cidades/" + e,
                type: "get",
                beforeSend: function () {
                    t.attr("disabled", "disabled"), t.find("option").remove(), t.append($("<option/>").val("").text("Aguarde..."))
                },
                complete: function (e) {
                    var n = JSON.parse(atob(e.responseText));
                    // t.find("option").remove(),
                        t.append($("<option/>").val("").text("SELECIONE UMA CIDADE")),
                    t.find("option").eq(0).remove(), $.each(n, function (e, n) {
                        t.append($("<option/>").val(e).text(n))
                    }), t.removeAttr("disabled");
                    if (modal !== undefined) {
                        t.material_select('destroy');
                        t.material_select();
                    }
                }
            })
        })
    }, i = function () {
        n.change(function () {
            var e = $(this).val();
            var form = $(this).parents("form");
            a = form.find("select[name='codcurso']");
            $.ajax({
                url: "/request/get/courses/" + e,
                type: "get",
                beforeSend: function () {
                    a.attr("disabled", "disabled"),
                        a.find("option").remove(),
                        a.append($("<option/>").val("").text("Aguarde..."))
                },
                success: function(e){
                    // a.find("option").remove(),
                    a.append($("<option/>").val("").text("Selecione um Curso"))
                },
                complete: function (e) {
                    var t = JSON.parse(atob(e.responseText));
                        $.each(t, function (e, t) {
                            "22612" !== t && a.append($("<option/>").val(t).text(e))
                        }),
                        a.find("option").eq(0).remove(),
                        a.removeAttr("disabled")
                }
            })
        })
    }, outrasLocalidades = function () {
        p.change(function () {
            if($(this).val() == 2061) {
                $('.outras-localidades').show();
            } else {
                $('.outras-localidades').hide();
            }
        });
    };
    this.construct()
}
